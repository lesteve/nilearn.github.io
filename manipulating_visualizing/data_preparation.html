
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Nilearn: Machine learning for NeuroImaging in Python &mdash; Machine learning for NeuroImaging</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.4.post1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Machine learning for NeuroImaging" href="../user_guide.html" />
    <link rel="up" title="4. Image manipulation and visualization" href="index.html" />
    <link rel="next" title="4.3. Manipulating brain volume: input/output, masking, ROIs, smoothing..." href="manipulating_images.html" />
    <link rel="prev" title="4.1. Plotting brain images" href="plotting.html" />
<meta content="True" name="HandheldFriendly">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="keywords" content="nilearn, neuroimaging, python, neuroscience, machinelearning">
<script type="text/javascript">
$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var top = 105 + $('.sphinxsidebarwrapper').offset().top - parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0)),
        sections = {},
        i        = 0,
	url	 = document.URL.replace(/#.*$/, ""),
	current_section = 0;

    // Grab positions of our sections 
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50;
    });

    $(window).scroll(function(event) {
	var pos   = $(window).scrollTop();
	// Lock the table of content to a fixed position once we scroll enough
	if(pos > top){
	    //begin to scroll
	    $('.sphinxsidebarwrapper').css("position", "fixed");
	    $('.sphinxsidebarwrapper').css("top", -105);
	}
	else{
	    //lock it back into place
	    $('.sphinxsidebarwrapper').css("position", "relative");
	    $('.sphinxsidebarwrapper').css("top",0);
	}
            
	// Highlight the current section
	$('a.internal').removeClass('active');
        for(i in sections){
            if(sections[i] > pos){
		break;
            };
	    if($('a.internal[href$="' + i + '"]').is(':visible')){
		current_section = i;
	    };
        }
	$('a.internal[href$="' + current_section + '"]').addClass('active');
    });

});
</script>


<script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </head>
  <body role="document">
<div id="logo-banner">
  <div class="logo">
    <a href="../index.html">
      <img src="../_static/nilearn-logo.png" alt="Nilearn logo"  border="0" />
    </a>
  </div>
  <!-- A tag cloud to make it easy for people to find what they are
                         looking for -->
 <div class="tags">
  <ul>
    <li>
      <big><a href="../auto_examples/plot_haxby_anova_svm.html">SVM</a></big>
    </li>
    <li>
      <small><a href="../data_analysis/parcellating.html">Ward
          clustering</a></small>
    </li>
    <li>
      <a href="../building_blocks/haxby_searchlight.html">Searchlight</a>
    </li>
    <li>
      <big><a href="../data_analysis/resting_state_networks.html">ICA</a></big>
    </li>
    <li>
      <a href="../building_blocks/data_preparation.html">Nifti IO</a>
    </li>
    <li>
      <a href="../modules/reference.html#module-nilearn.datasets">Datasets</a>
    </li>
  </ul>
 </div>

  <div class="banner">
    <h1>Nilearn:</h1>
    <h2>Machine learning for Neuro-Imaging in Python</h2>
  </div>
  <div class="search_form">
    <div id="cse" style="width: 100%;"></div>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
      google.load('search', '1', {language : 'en'});
      google.setOnLoadCallback(function() {
      var customSearchControl = new google.search.CustomSearchControl('014136483057745874622:r-npolb1uki');
      customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
      var options = new google.search.DrawOptions();
      options.setAutoComplete(true);
      customSearchControl.draw('cse', options);
      }, true);
    </script>
  </div>
</div>



    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="manipulating_images.html" title="4.3. Manipulating brain volume: input/output, masking, ROIs, smoothing..."
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plotting.html" title="4.1. Plotting brain images"
             accesskey="P">previous</a> |</li>
<li><a href="../index.html">Nilearn Home</a> |&nbsp;</li>
<li><a href="../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../auto_examples/index.html">Examples</a> |&nbsp;</li>
<li><a href="../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../AUTHORS.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">4. Image manipulation and visualization</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">


<h4> Giving credit </h4>
  <ul class="simple">
    <li><p>Please consider <a href="../AUTHORS.html#citing">citing the
                    scikit-learn</a> if you use it.</p></li>
  </ul>

  <h3><a href="../user_guide.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.2. Data preparation: loading and basic transformation</a><ul>
<li><a class="reference internal" href="#the-concept-of-masker-objects">4.2.1. The concept of &#8220;masker&#8221; objects</a></li>
<li><a class="reference internal" href="#niftimasker-loading-masking-and-filtering">4.2.2. <code class="docutils literal"><span class="pre">NiftiMasker</span></code>: loading, masking and filtering</a><ul>
<li><a class="reference internal" href="#custom-data-loading">4.2.2.1. Custom data loading</a></li>
<li><a class="reference internal" href="#controlling-how-the-mask-is-computed-from-the-data">4.2.2.2. Controlling how the mask is computed from the data</a><ul>
<li><a class="reference internal" href="#computing-the-mask">4.2.2.2.1. Computing the mask</a></li>
</ul>
</li>
<li><a class="reference internal" href="#common-data-preparation-steps-resampling-smoothing-filtering">4.2.2.3. Common data preparation steps: resampling, smoothing, filtering</a><ul>
<li><a class="reference internal" href="#resampling">4.2.2.3.1. Resampling</a></li>
<li><a class="reference internal" href="#smoothing">4.2.2.3.2. Smoothing</a></li>
<li><a class="reference internal" href="#temporal-filtering">4.2.2.3.3. Temporal Filtering</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inverse-transform-unmasking-data">4.2.2.4. Inverse transform: unmasking data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extraction-of-signals-from-regions-niftilabelsmasker-niftimapsmasker">4.2.3. Extraction of signals from regions: <code class="docutils literal"><span class="pre">NiftiLabelsMasker</span></code>, <code class="docutils literal"><span class="pre">NiftiMapsMasker</span></code>.</a><ul>
<li><a class="reference internal" href="#regions-definition">4.2.3.1. Regions definition</a></li>
<li><a class="reference internal" href="#niftimapsmasker-usage">4.2.3.2. <code class="docutils literal"><span class="pre">NiftiMapsMasker</span></code> Usage</a></li>
<li><a class="reference internal" href="#niftilabelsmasker-usage">4.2.3.3. <code class="docutils literal"><span class="pre">NiftiLabelsMasker</span></code> Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="plotting.html"
                        title="previous chapter">4.1. Plotting brain images</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="manipulating_images.html"
                        title="next chapter">4.3. Manipulating brain volume: input/output, masking, ROIs, smoothing...</a></p>

<div class="navbar">
</div> <!-- end navbar -->

<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="data-preparation-loading-and-basic-transformation">
<span id="extracting-data"></span><h1>4.2. Data preparation: loading and basic transformation<a class="headerlink" href="#data-preparation-loading-and-basic-transformation" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<p class="topic-title first"><strong>Contents</strong></p>
<ul class="simple">
<li><a class="reference internal" href="#the-concept-of-masker-objects" id="id4">The concept of &#8220;masker&#8221; objects</a></li>
<li><a class="reference internal" href="#niftimasker-loading-masking-and-filtering" id="id5"><a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a>: loading, masking and filtering</a></li>
<li><a class="reference internal" href="#extraction-of-signals-from-regions-niftilabelsmasker-niftimapsmasker" id="id6">Extraction of signals from regions: <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiLabelsMasker.html#nilearn.input_data.NiftiLabelsMasker" title="nilearn.input_data.NiftiLabelsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiLabelsMasker</span></code></a>, <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMapsMasker.html#nilearn.input_data.NiftiMapsMasker" title="nilearn.input_data.NiftiMapsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMapsMasker</span></code></a>.</a></li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="topic">
<p class="topic-title first"><strong>File names as arguments</strong></p>
<p>For most functions or objects, it is not necessary to explicitely load
the data. Indeed, most of nilearn functions can take file names as
arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">image</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smoothed_img</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">smooth_img</span><span class="p">(</span><span class="s">&#39;/home/user/t_map001.nii&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Nilearn can operate on either filenames, or <a class="reference external" href="http://nipy.org/nibabel/nibabel_images.html">NiftiImage objects</a>, which are
in-memory representation of the nifti files. We often use as a
shorthand the term &#8216;niimg&#8217; to denote either a filename or a
NiftiImage object. In the example above, the function smooth_img
returns a NiftiImage object, which can then be readily passed to any
other nilearn function that accept niimg arguments.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="the-concept-of-masker-objects">
<h2><a class="toc-backref" href="#id4">4.2.1. The concept of &#8220;masker&#8221; objects</a><a class="headerlink" href="#the-concept-of-masker-objects" title="Permalink to this headline">¶</a></h2>
<p>In any analysis, the first step is to load the data. Often, for
statistical analysis, it is convenient to apply some basic
transformations and to turn the data in a 2D (samples x features) matrix,
where the samples could be different time points, and the features
different voxels or different ROIs.</p>
<p class="centered">
<strong><a class="reference internal" href="../_images/niimgs1.jpg"><img alt="niimgs" src="../_images/niimgs1.jpg" style="width: 367.0px; height: 163.5px;" /></a>  <span style="padding: .5em; font-size: 400%">&rarr;</span>  <a class="reference internal" href="../_images/feature_array1.jpg"><img alt="arrays" src="../_images/feature_array1.jpg" style="width: 115.15px; height: 167.3px;" /></a></strong></p><p>&#8220;masker&#8221; objects (found in modules <a class="reference internal" href="../modules/reference.html#module-nilearn.input_data" title="nilearn.input_data"><code class="xref py py-mod docutils literal"><span class="pre">nilearn.input_data</span></code></a>) are there
to make these operations easy.</p>
<p>The philosophy underlying these classes is similar to <a class="reference external" href="http://scikit-learn.org">scikit-learn</a>&#8216;s
transformers. Objects are initialized with some parameters proper to
the transformation (unrelated to the data), then the fit() method
should be called, possibly specifying some data-related
information (such as number of images to process), to perform some
initial computation (e.g. fitting a mask based on the data). Then
transform() can be called, with the data as argument, to perform some
computation on data themselves (e.g. extracting timeseries from images).</p>
<p>Note that the masker objects may not cover all the image transformations
for specific tasks. Users who want to make some specific processing may
have to call low-level functions (see e.g. <a class="reference internal" href="../modules/reference.html#module-nilearn.signal" title="nilearn.signal"><code class="xref py py-mod docutils literal"><span class="pre">nilearn.signal</span></code></a>,
<a class="reference internal" href="../modules/reference.html#module-nilearn.masking" title="nilearn.masking"><code class="xref py py-mod docutils literal"><span class="pre">nilearn.masking</span></code></a>.)</p>
</div>
<div class="section" id="niftimasker-loading-masking-and-filtering">
<span id="nifti-masker"></span><h2><a class="toc-backref" href="#id5">4.2.2. <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a>: loading, masking and filtering</a><a class="headerlink" href="#niftimasker-loading-masking-and-filtering" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to use the <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a> class in
more details than the previous description. <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a> is a
powerful tool to load images and extract voxel signals in the area
defined by the mask. It is designed to apply some basic preprocessing
steps by default with commonly used default parameters. But it is
<em>very important</em> to look at your data to see the effects of the
preprocessings and validate them.</p>
<p>In addition, <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a> is a <a class="reference external" href="http://scikit-learn.org">scikit-learn</a> compliant
transformer so that you can directly plug it into a <a class="reference external" href="http://scikit-learn.org/stable/modules/pipeline.html">scikit-learn
pipeline</a>.</p>
<div class="section" id="custom-data-loading">
<h3>4.2.2.1. Custom data loading<a class="headerlink" href="#custom-data-loading" title="Permalink to this headline">¶</a></h3>
<p>Sometimes, some custom preprocessing of data is necessary. For instance
we can restrict a dataset to the first 100 frames. Below, we load
a resting-state dataset with <a class="reference internal" href="../modules/generated/nilearn.datasets.fetch_nyu_rest.html#nilearn.datasets.fetch_nyu_rest" title="nilearn.datasets.fetch_nyu_rest"><code class="xref py py-func docutils literal"><span class="pre">fetch_fetch_nyu_rest()</span></code></a>, restrict it to 100 frames and
build a brand new Nifti-like object to give it to the masker. Though it
is possible, there is no need to save your data in a file to pass it to a
<a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a>. Simply use <a class="reference external" href="http://nipy.sourceforge.net/nibabel/">nibabel</a> to create a <a class="reference internal" href="manipulating_images.html#niimg"><span>Niimg</span></a>
in memory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">nyu_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_nyu_rest</span><span class="p">(</span><span class="n">n_subjects</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">nyu_filename</span> <span class="o">=</span> <span class="n">nyu_dataset</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">nyu_img</span> <span class="o">=</span> <span class="n">nibabel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">nyu_filename</span><span class="p">)</span>

<span class="c"># Restrict nyu to 100 frames to speed up computation</span>
<span class="kn">from</span> <span class="nn">nilearn.image</span> <span class="kn">import</span> <span class="n">index_img</span>
<span class="n">nyu_img</span> <span class="o">=</span> <span class="n">index_img</span><span class="p">(</span><span class="n">nyu_img</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="controlling-how-the-mask-is-computed-from-the-data">
<h3>4.2.2.2. Controlling how the mask is computed from the data<a class="headerlink" href="#controlling-how-the-mask-is-computed-from-the-data" title="Permalink to this headline">¶</a></h3>
<p>In the basic tutorial, we showed how the masker could compute a mask
automatically, and it has done a good job. But, on some datasets, the
default algorithm performs poorly. This is why it is very important to
<strong>always look at how your data look like</strong>.</p>
<div class="section" id="computing-the-mask">
<h4>4.2.2.2.1. Computing the mask<a class="headerlink" href="#computing-the-mask" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The full example described in this section can be found here:
<a class="reference internal" href="../auto_examples/manipulating_visualizing/plot_mask_computation.html"><em>plot_mask_computation.py</em></a>.
This one can be relevant too:
<a class="reference internal" href="../auto_examples/plot_nifti_simple.html"><em>plot_nifti_simple.py</em></a>.</p>
</div>
<p>If a mask is not given, <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a> will try to compute
one. It is <em>very important</em> to take a look at the generated mask, to see if it
is suitable for your data and adjust parameters if it is not. See the
<a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a> documentation for a complete list of mask computation
parameters.</p>
<p>As an example, we will now try to build a mask based on a dataset from
scratch. The Haxby dataset will be used since it provides a mask that we
can use as a reference.</p>
<p>The first step is to generate a mask with default parameters and take
a look at it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># We need to specify an &#39;epi&#39; mask_strategy, as this is raw EPI data</span>
<span class="n">masker</span> <span class="o">=</span> <span class="n">NiftiMasker</span><span class="p">(</span><span class="n">mask_strategy</span><span class="o">=</span><span class="s">&#39;epi&#39;</span><span class="p">)</span>
<span class="n">masker</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nyu_img</span><span class="p">)</span>
<span class="n">plot_roi</span><span class="p">(</span><span class="n">masker</span><span class="o">.</span><span class="n">mask_img_</span><span class="p">,</span> <span class="n">nyu_mean_img</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;EPI automatic mask&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure">
<a class="reference external image-reference" href="../auto_examples/plot_mask_computation.html"><img alt="../_images/plot_mask_computation_0021.png" src="../_images/plot_mask_computation_0021.png" style="width: 330.0px; height: 130.0px;" /></a>
</div>
<p>We can make the outline of the mask more by increasing the number of
opening steps (<em>opening=10</em>) using the <cite>mask_args</cite> argument of the
<a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">masker</span> <span class="o">=</span> <span class="n">NiftiMasker</span><span class="p">(</span><span class="n">mask_strategy</span><span class="o">=</span><span class="s">&#39;epi&#39;</span><span class="p">,</span> <span class="n">mask_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">opening</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="n">masker</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nyu_img</span><span class="p">)</span>
<span class="n">plot_roi</span><span class="p">(</span><span class="n">masker</span><span class="o">.</span><span class="n">mask_img_</span><span class="p">,</span> <span class="n">nyu_mean_img</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;EPI Mask with strong opening&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure">
<a class="reference external image-reference" href="../auto_examples/plot_mask_computation.html"><img alt="../_images/plot_mask_computation_0031.png" src="../_images/plot_mask_computation_0031.png" style="width: 330.0px; height: 130.0px;" /></a>
</div>
<p>Looking at the <a class="reference internal" href="../modules/generated/nilearn.masking.compute_epi_mask.html#nilearn.masking.compute_epi_mask" title="nilearn.masking.compute_epi_mask"><code class="xref py py-func docutils literal"><span class="pre">nilearn.masking.compute_epi_mask</span></code></a> called by the
<a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a> object, we see two interesting parameters:
<em>lower_cutoff</em> and <em>upper_cutoff</em>. These set the grey-values bounds in
which the masking algorithm is going to try to find it&#8217;s threshold (where
0 is the minimum of the image, and 1 the maximum). Here we raise a lot
the lower cutoff, and thus force the masking algorithm to select only
voxels that are very light on the EPI image.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">masker</span> <span class="o">=</span> <span class="n">NiftiMasker</span><span class="p">(</span><span class="n">mask_strategy</span><span class="o">=</span><span class="s">&#39;epi&#39;</span><span class="p">,</span>
                     <span class="n">mask_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">upper_cutoff</span><span class="o">=.</span><span class="mi">9</span><span class="p">,</span> <span class="n">lower_cutoff</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span>
                                    <span class="n">opening</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
<span class="n">masker</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nyu_img</span><span class="p">)</span>
<span class="n">plot_roi</span><span class="p">(</span><span class="n">masker</span><span class="o">.</span><span class="n">mask_img_</span><span class="p">,</span> <span class="n">nyu_mean_img</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;EPI Mask: high lower_cutoff&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure">
<a class="reference external image-reference" href="../auto_examples/plot_mask_computation.html"><img alt="../_images/plot_mask_computation_0041.png" src="../_images/plot_mask_computation_0041.png" style="width: 330.0px; height: 130.0px;" /></a>
</div>
</div>
</div>
<div class="section" id="common-data-preparation-steps-resampling-smoothing-filtering">
<h3>4.2.2.3. Common data preparation steps: resampling, smoothing, filtering<a class="headerlink" href="#common-data-preparation-steps-resampling-smoothing-filtering" title="Permalink to this headline">¶</a></h3>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">If you don&#8217;t want to use the <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a> to perform these
simple operations on data, note that they are
<a class="reference internal" href="manipulating_images.html#preprocessing-functions"><span>corresponding functions</span></a>.</p>
</div>
<div class="section" id="resampling">
<span id="id2"></span><h4>4.2.2.3.1. Resampling<a class="headerlink" href="#resampling" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt><a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a> and many similar classes enable resampling images.</dt>
<dd>The resampling procedure takes as input the
<em>target_affine</em> to resample (resize, rotate...) images in order
to match the spatial configuration defined by the new
affine. Additionally, a <em>target_shape</em> can be used to resize
images (i.e. croping or padding with zeros) to match an
expected shape.</dd>
</dl>
<p>Resampling can be used for example to reduce processing time by
lowering image resolution. Certain image viewers also require images to be
resampled to display overlays.</p>
<p>Automatic computation of offset and bounding box can be performed by
specifying a 3x3 matrix instead of the 4x4 affine, in which case nilearn
computes automatically the translation part of the affine.</p>
<a class="reference external image-reference" href="../auto_examples/plot_affine_transformation.html"><img alt="../_images/plot_affine_transformation_0021.png" src="../_images/plot_affine_transformation_0021.png" style="width: 288.0px; height: 216.0px;" /></a>
<a class="reference external image-reference" href="../auto_examples/plot_affine_transformation.html"><img alt="../_images/plot_affine_transformation_0041.png" src="../_images/plot_affine_transformation_0041.png" style="width: 288.0px; height: 216.0px;" /></a>
<a class="reference external image-reference" href="../auto_examples/plot_affine_transformation.html"><img alt="../_images/plot_affine_transformation_0031.png" src="../_images/plot_affine_transformation_0031.png" style="width: 288.0px; height: 216.0px;" /></a>
<div class="topic">
<p class="topic-title first"><strong>Special case: resampling to a given voxel size</strong></p>
<p>Specifying a 3x3 matrix that is diagonal as a target_affine fixes the
voxel size. For instance to resample to 3x3x3 mm voxels:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target_affine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../modules/generated/nilearn.image.resample_img.html#nilearn.image.resample_img" title="nilearn.image.resample_img"><code class="xref py py-func docutils literal"><span class="pre">nilearn.image.resample_img</span></code></a></p>
</div>
</div>
<div class="section" id="smoothing">
<h4>4.2.2.3.2. Smoothing<a class="headerlink" href="#smoothing" title="Permalink to this headline">¶</a></h4>
<p>If smoothing the data prior to converting to voxel signals is required, it can
be performed by <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a>. It is achieved by passing the full-width
half maximum (in millimeter) along each axis in the parameter <cite>smoothing_fwhm</cite>.
For an isotropic filtering, passing a scalar is also possible. The underlying
function handles properly the tricky case of non-cubic voxels, by scaling the
given widths appropriately.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../modules/generated/nilearn.image.smooth_img.html#nilearn.image.smooth_img" title="nilearn.image.smooth_img"><code class="xref py py-func docutils literal"><span class="pre">nilearn.image.smooth_img</span></code></a></p>
</div>
</div>
<div class="section" id="temporal-filtering">
<span id="id3"></span><h4>4.2.2.3.3. Temporal Filtering<a class="headerlink" href="#temporal-filtering" title="Permalink to this headline">¶</a></h4>
<p>All previous filters operate on images, before conversion to voxel signals.
<a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a> can also process voxel signals. Here are the possibilities:</p>
<ul class="simple">
<li>Confound removal. Two ways of removing confounds are provided. Any linear
trend can be removed by activating the <cite>detrend</cite> option. It is not activated
by default in <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></code></a> but is almost essential. More complex confounds can
be removed by passing them to <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker.transform" title="nilearn.input_data.NiftiMasker.transform"><code class="xref py py-meth docutils literal"><span class="pre">NiftiMasker.transform</span></code></a>. If the
dataset provides a confounds file, just pass its path to the masker.</li>
<li>Linear filtering. Low-pass and high-pass filters can be used to remove artifacts.
Care has been taken to apply this processing to confounds if necessary.</li>
<li>Normalization. Signals can be normalized (scaled to unit variance) before
returning them. This is performed by default.</li>
</ul>
<div class="topic">
<p class="topic-title first"><strong>Exercise</strong></p>
<p>You can, more as a training than as an exercise, try to play with
the parameters in <a class="reference internal" href="../auto_examples/plot_haxby_simple.html#example-plot-haxby-simple-py"><span>Simple example of decoding: the Haxby data</span></a>. Try to enable detrending
and run the script: does it have a big impact on the result?</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../modules/generated/nilearn.signal.clean.html#nilearn.signal.clean" title="nilearn.signal.clean"><code class="xref py py-func docutils literal"><span class="pre">nilearn.signal.clean</span></code></a></p>
</div>
</div>
</div>
<div class="section" id="inverse-transform-unmasking-data">
<h3>4.2.2.4. Inverse transform: unmasking data<a class="headerlink" href="#inverse-transform-unmasking-data" title="Permalink to this headline">¶</a></h3>
<p>Once voxel signals have been processed, the result can be visualized as
images after unmasking (turning voxel signals into a series of images,
using the same mask as for masking). This step is present in almost all
the <a class="reference internal" href="../auto_examples/index.html#examples-index"><span>examples</span></a> provided in nilearn. Below is
an excerpt of <a class="reference internal" href="../auto_examples/decoding/plot_haxby_anova_svm.html#example-decoding-plot-haxby-anova-svm-py"><span>the example performing Anova-SVM on the Haxby data</span></a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">coef</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">coef_</span>
<span class="c"># reverse feature selection</span>
<span class="n">coef</span> <span class="o">=</span> <span class="n">feature_selection</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
<span class="c"># reverse masking</span>
<span class="n">weight_img</span> <span class="o">=</span> <span class="n">nifti_masker</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="extraction-of-signals-from-regions-niftilabelsmasker-niftimapsmasker">
<span id="region"></span><h2><a class="toc-backref" href="#id6">4.2.3. Extraction of signals from regions: <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiLabelsMasker.html#nilearn.input_data.NiftiLabelsMasker" title="nilearn.input_data.NiftiLabelsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiLabelsMasker</span></code></a>, <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMapsMasker.html#nilearn.input_data.NiftiMapsMasker" title="nilearn.input_data.NiftiMapsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMapsMasker</span></code></a>.</a><a class="headerlink" href="#extraction-of-signals-from-regions-niftilabelsmasker-niftimapsmasker" title="Permalink to this headline">¶</a></h2>
<p>The purpose of <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiLabelsMasker.html#nilearn.input_data.NiftiLabelsMasker" title="nilearn.input_data.NiftiLabelsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiLabelsMasker</span></code></a> and <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMapsMasker.html#nilearn.input_data.NiftiMapsMasker" title="nilearn.input_data.NiftiMapsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMapsMasker</span></code></a> is to
compute signals from regions containing many voxels. They make it easy to get
these signals once you have an atlas or a parcellation.</p>
<div class="section" id="regions-definition">
<h3>4.2.3.1. Regions definition<a class="headerlink" href="#regions-definition" title="Permalink to this headline">¶</a></h3>
<p>Nilearn understands two different ways of defining regions, which are called
labels and maps, handled respectively by <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiLabelsMasker.html#nilearn.input_data.NiftiLabelsMasker" title="nilearn.input_data.NiftiLabelsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiLabelsMasker</span></code></a> and
<a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMapsMasker.html#nilearn.input_data.NiftiMapsMasker" title="nilearn.input_data.NiftiMapsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMapsMasker</span></code></a>.</p>
<ul class="simple">
<li>labels: a single region is defined as the set of all the voxels that have a
common label (usually an integer) in the region definition array. The set of
regions is defined by a single 3D array, containing at each location the label
of the region the voxel is in. This technique has one big advantage: the
amount of memory required is independent of the number of regions, allowing
for representing a large number of regions. On the other hand, there are
several contraints: regions cannot overlap, and only their support could be
represented (no weighting).</li>
<li>maps: a single region is defined as the set of all the voxels that have a
non-zero weight. A set of regions is thus defined by a set of 3D images (or a
single 4D image), one 3D image per region. Overlapping regions with weights
can be represented, but with a storage cost that scales linearly with the
number of regions. Handling a large number (thousands) of regions will prove
difficult with this representation.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These usage are illustrated in <a class="reference internal" href="../connectivity/functional_connectomes.html#functional-connectomes"><span>Extracting times series to build a functional connectome</span></a></p>
</div>
</div>
<div class="section" id="niftimapsmasker-usage">
<h3>4.2.3.2. <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMapsMasker.html#nilearn.input_data.NiftiMapsMasker" title="nilearn.input_data.NiftiMapsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMapsMasker</span></code></a> Usage<a class="headerlink" href="#niftimapsmasker-usage" title="Permalink to this headline">¶</a></h3>
<p>This atlas defines its regions using maps. The path to the corresponding
file is given in the &#8220;maps_img&#8221; argument. Extracting region signals for
several subjects can be performed like this:</p>
<p>One important thing that happens transparently during the execution of
<a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker.fit_transform" title="nilearn.input_data.NiftiMasker.fit_transform"><code class="xref py py-meth docutils literal"><span class="pre">NiftiMasker.fit_transform</span></code></a> is resampling. Initially, the images
and the atlas do not have the same shape nor the same affine. Getting
them to the same format is required for the signals extraction to
work. The keyword argument <cite>resampling_target</cite> specifies which format
everything should be resampled to.
See the reference documentation for <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMapsMasker.html#nilearn.input_data.NiftiMapsMasker" title="nilearn.input_data.NiftiMapsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMapsMasker</span></code></a> for every
possible option.</p>
</div>
<div class="section" id="niftilabelsmasker-usage">
<h3>4.2.3.3. <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiLabelsMasker.html#nilearn.input_data.NiftiLabelsMasker" title="nilearn.input_data.NiftiLabelsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiLabelsMasker</span></code></a> Usage<a class="headerlink" href="#niftilabelsmasker-usage" title="Permalink to this headline">¶</a></h3>
<p>Usage of <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiLabelsMasker.html#nilearn.input_data.NiftiLabelsMasker" title="nilearn.input_data.NiftiLabelsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiLabelsMasker</span></code></a> is similar to that of
<a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMapsMasker.html#nilearn.input_data.NiftiMapsMasker" title="nilearn.input_data.NiftiMapsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiMapsMasker</span></code></a>. The main difference is that it requires a labels image
instead of a set of maps as input.</p>
<p>The <cite>background_label</cite> keyword of <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiLabelsMasker.html#nilearn.input_data.NiftiLabelsMasker" title="nilearn.input_data.NiftiLabelsMasker"><code class="xref py py-class docutils literal"><span class="pre">NiftiLabelsMasker</span></code></a> deserves
some explanation. The voxels that correspond to the brain or a region
of interest in an fMRI image do not fill the entire
image. Consequently, in the labels image, there must be a label
corresponding to &#8220;outside&#8221; the brain, for which no signal should be
extracted.  By default, this label is set to zero in nilearn, and is
referred to as &#8220;background&#8221;. Should some non-zero value occur, it is
possible to change the background value with the <cite>background_label</cite>
keyword.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="manipulating_images.html" title="4.3. Manipulating brain volume: input/output, masking, ROIs, smoothing..."
             >next</a> |</li>
        <li class="right" >
          <a href="plotting.html" title="4.1. Plotting brain images"
             >previous</a> |</li>
<li><a href="../index.html">Nilearn Home</a> |&nbsp;</li>
<li><a href="../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../auto_examples/index.html">Examples</a> |&nbsp;</li>
<li><a href="../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../AUTHORS.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li class="nav-item nav-item-1"><a href="index.html" >4. Image manipulation and visualization</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
            &copy; The nilearn developers 2010-2015.
          Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
        <span style="padding-left: 5ex;">
          <a href="../_sources/manipulating_visualizing/data_preparation.txt"
        	 rel="nofollow">Show this page source</a>
        </span>
    </div>
  </body>
</html>